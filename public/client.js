const socket = io();
const loginScreen=document.getElementById("login-screen"),loginForm=document.getElementById("login-form"),usernameInput=document.getElementById("username-input"),joinButton=document.getElementById("join-button"),gameContainer=document.getElementById("game-container"),statusMessage=document.getElementById("status-message"),gameContent=document.getElementById("game-content"),commodityList=document.getElementById("commodity-list"),selfPlayerArea=document.getElementById("player-self"),opponentPlayerArea=document.getElementById("player-opponent"),selfGuessesList=document.getElementById("self-guesses"),opponentGuessesList=document.getElementById("opponent-guesses"),guessForm=document.getElementById("guess-form"),guessInput=document.getElementById("guess-input"),submitButton=document.getElementById("submit-button"),autocompleteContainer=document.getElementById("autocomplete-container"),playAgainContainer=document.getElementById("play-again-container"),playAgainButton=document.getElementById("play-again-button");let myPlayerId=null,myRoomName=null,allCountries=[],selectedCountry=null;function updateCommodities(e){commodityList.innerHTML="",e.forEach(e=>{let t=document.createElement("li");t.className="commodity-item",t.innerHTML=`<span class="commodity-name">${e.name}</span><span class="commodity-value">${e.value}</span>`,commodityList.appendChild(t)})}function addGuessToHistory(e){const{guesserId:t,guesserName:o,guess:n,distance:a}=e;let s=document.createElement("li");s.className="guess-item";let i=t===myPlayerId?`<span class="guess-distance">${a}</span>`:"",l=t===myPlayerId?n:`${o}: ${n}`;s.innerHTML=`<span class="guess-name">${l}</span> ${i}`,t===myPlayerId?(selfGuessesList.appendChild(s),selfGuessesList.scrollTop=selfGuessesList.scrollHeight):(opponentGuessesList.appendChild(s),opponentGuessesList.scrollTop=opponentGuessesList.scrollHeight)}function updateAutocomplete(e){autocompleteContainer.innerHTML="",e&&(0!==(e=allCountries.filter(t=>t.toLowerCase().startsWith(e.toLowerCase()))).length&&((t=document.createElement("ul")).className="autocomplete-list",e.slice(0,100).forEach(e=>{let o=document.createElement("li");o.className="autocomplete-item",o.textContent=e,o.addEventListener("mousedown",()=>{guessInput.value=e,selectedCountry=e,autocompleteContainer.innerHTML="",submitButton.disabled=!1}),t.appendChild(o)}),autocompleteContainer.appendChild(t)));var t}socket.on("connect",()=>{myPlayerId=socket.id,console.log("Connected to server with ID:",myPlayerId)}),socket.on("waiting",e=>{statusMessage.textContent=e.message}),socket.on("gameStart",e=>{statusMessage.textContent="Opponent found!",gameContent.style.display="block",allCountries=e.allCountries.sort(),myRoomName=e.roomName;var t=e.players[myPlayerId],o=Object.keys(e.players).find(e=>e!==myPlayerId),n=e.players[o];selfPlayerArea.querySelector("h2").textContent=`You (${t})`,opponentPlayerArea.querySelector("h2").textContent=`Opponent (${n})`}),socket.on("newRound",e=>{statusMessage.textContent="Guess the country!",statusMessage.className="",updateCommodities(e.commodities),selfGuessesList.innerHTML="",opponentGuessesList.innerHTML="",guessInput.value="",guessInput.disabled=!1,submitButton.disabled=!0,selectedCountry=null,playAgainContainer.style.display="none",playAgainButton.disabled=!1,playAgainButton.textContent="Play Again"}),socket.on("guessResult",e=>{addGuessToHistory(e),e.guesserId===myPlayerId&&(guessInput.disabled=!1,guessInput.value="",guessInput.focus())}),socket.on("roundOver",e=>{const{winnerId:t,winnerName:o,answer:n}=e;let a="";t===myPlayerId?(a=`You win! The country was ${n}.`,statusMessage.className="winner-announcement win-message"):(a=`${o} wins! The country was ${n}.`,statusMessage.className="winner-announcement lose-message"),statusMessage.textContent=a,guessInput.disabled=!0,submitButton.disabled=!0,playAgainContainer.style.display="block"}),socket.on("opponentLeft",e=>{statusMessage.textContent=e.message,statusMessage.className="winner-announcement lose-message",guessInput.disabled=!0,submitButton.disabled=!0,autocompleteContainer.innerHTML="",playAgainContainer.style.display="none"}),socket.on("disconnect",()=>{loginScreen.style.display="flex",gameContainer.style.display="none",statusMessage.textContent="Connection lost. Please reconnect."}),loginForm.addEventListener("submit",e=>{e.preventDefault();let t=usernameInput.value;t.trim()&&(socket.emit("playerJoining",{username:t}),loginScreen.style.display="none",gameContainer.style.display="block",statusMessage.textContent="Connected! Waiting for a game...")}),guessInput.addEventListener("focus",()=>updateAutocomplete(guessInput.value)),guessInput.addEventListener("input",()=>{updateAutocomplete(guessInput.value),selectedCountry=null,submitButton.disabled=!0}),document.addEventListener("click",e=>{guessForm.contains(e.target)||(autocompleteContainer.innerHTML="")}),guessForm.addEventListener("submit",e=>{e.preventDefault(),selectedCountry&&myRoomName&&(socket.emit("submitGuess",{guess:selectedCountry,roomName:myRoomName}),guessInput.disabled=!0,submitButton.disabled=!0)}),playAgainButton.addEventListener("click",()=>{playAgainButton.disabled=!0,playAgainButton.textContent="Waiting for opponent...",socket.emit("requestPlayAgain",{roomName:myRoomName})});